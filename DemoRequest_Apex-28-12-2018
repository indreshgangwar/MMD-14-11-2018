<!---------
   Author: Anita
   Created Date: 1/11/2018
   Created For: This visualforce page is implemented for Inserting a Demo Request from the portal to the Custom object "Demo Request".
   ---------->
<apex:page controller="DemoRequest_Apex_cntrlr" standardStylesheets="false" id="pgid" showHeader="false" sidebar="false" docType="html-5.0">
   <c:head_include ></c:head_include>
   <c:portal_Script ></c:portal_Script>
   <meta content="width=device-width" name="viewport" />
   <style> 
      @media all and (min-width: 960px) {
      body{
      font-size: 14px;
      }
      }
      @media all and (max-width: 959px) and (min-width: 600px) {
      body{
      font-size: 15px;
      }
      .site-logo {
      padding: 0px 31px !important;
      margin: 0px 0px;
      }
      }
      @media all and (max-width: 599px) and (min-width: 320px) {
      body{
      font-size: 17px;
      }
      .site-logo {
      padding: 0px 14px !important;
      margin: 0px 0px;
      }
      }
      .download-center{
      background-image: url('{!URLFOR($Resource.img, '/img/backgrounds/profile-banner.jpg')}');
      height:200px; 
      min-height:250px; 
      width:100%; 
      margin:0; 
      padding:0;     
      background-size: cover;
      }
      .welcome-user{
      background: none;
      border: none;
      font-size: 14px;
      }
      textarea.form-control{
      height:auto;
      min-height:70px;
      }
      .form-control{
      height: 34px!important;
      padding: 6px 12px !important;
      font-size:14px !important;
      }
      /* Close icon */
      .close1 {
      color: #aeafaf;
      float: right;
      font-size: 15px;
      font-weight: bold;
      }
      .btn-margin:{
      margin: 10px 15px 10px 0px!important;
      }
      .btn-width{
      width:150px !important;
      }
      /* Close icon */
      .close1 {
      color: #aeafaf;
      float: right;
      font-size: 15px;
      font-weight: bold;
      }
      .error-msg{
      color:red; 
      list-style-type: none; 
      padding: 9px 0 0 0;
      font-size: 11px;
      }
      .error-msg-output {
      color: red;
      list-style-type: none;
      font-size: 11px;
      position: absolute;
      }
      .req-mark{
            color: red;
            font-size: 17px;
            line-height: 16px;
         }
         .apex-button{
         height: 28px; 
         width: 130px;  
         margin: 0;  
         padding: 5px 0px;
         vertical-align: middle;  
         border: 0;  
         font-size: 13px;  
         font-weight: 400;  
         line-height: 18px;  
         float: left; 
         margin: 4px 10px 8px 0px;
         text-align:center;
         border-radius:3px;
         cursor:pointer;
         }
         .error-msg{
                 color: red;
                list-style-type: none;
                padding: 0px 0 0 0;
                font-size: 11px;
                line-height: 8px;

         }
         .pd-10{
             margin-top: 10px;
         }
   </style>
   <body>
      <script>
         $(window).scroll(function() {
             if($(this).scrollTop()>0) {
                 $( ".navbar-me" ).addClass("fixed-me");
             } else {
                 $( ".navbar-me" ).removeClass("fixed-me");
             }
         });
      </script>
      <!--navbar menu-->
      <section class="navbar-info">
         <c:DealerSideMenu ></c:DealerSideMenu>
      </section>
      <div id="main">
         <apex:form id="demoreq" >
            <div style="width:90%; margin:0 auto;">
               <div class="row" style="min-height:350px;">
                  <div class="title-grid">
                     <h3>New Demo Request</h3>
                     <p class="forgotten" style="text-align:right;">
                        <apex:outputLink value="/apex/DemoRequestList?id={!contactId }"><span style="margin-right:5px;"><i class="fa fa-file-text-o"></i></span> View Demo List </apex:outputLink>
                     </p>
                  </div>
                  <span Class="error-msg">Items marked with (*) are required.</span>
                  <div class="row">
                    <div class="col-md-12" style="height:10px;">
                        <apex:outputText value="{!errormsg}" styleClass="error-msg"></apex:outputText>
                          <apex:outputText value="{!errormsgDate}" styleClass="error-msg"></apex:outputText>
                    </div>
                  </div>

                  <div class="panel panel-default" style="margin-top:10px;">
                     <div class="panel-body" id="case-title">
                        <div  id="case-title">
                           <h5>Demo Delivery Details</h5>
                           

                           <div class="form">
                              <div class="row">
                                 <!--FORM SECTION START HERE-->
                                 <div class="form-row ">
                                    <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                       <label for="PointofContact">Contact for this Demo<span class="req-mark">*</span></label>  
                                       <apex:input type="text" id="PointofContact" value="{!demoContact}" html-placeholder="Contact Name" styleClass="form-control"/>
                                       <!--       <apex:outputPanel > <apex:actionRegion >   <apex:input type="text" id="PointofContact" value="{!demoContact}" html-placeholder="Point of Contact" styleClass="form-control"/>
                                          <apex:outputText value="{!errormsg}" rendered="{!demoContact==''}" style="color:red;" ></apex:outputText> </apex:actionRegion>
                                          </apex:outputPanel>  -->
                                    </div>
                                    <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                       <label for="Mobile">Mobile Number<span class="req-mark">*</span></label>
                                       <div class="input-group" style="width:100%;">
                                       <apex:input value="{!democCode}"   styleClass="form-control"  style="width:23%;"   html-placeholder="+00"> 
                                       <apex:actionSupport event="onchange" reRender="outid"/>  </apex:input> 
                                       <apex:input type="text" id="Mobile" value="{!demoMobile}" html-placeholder="Mobile" styleClass="form-control" style="width:77%;" > 
                                          <apex:actionSupport event="onchange" reRender="outid"/>
                                       </apex:input></div>
                                       <apex:outputPanel id="outid">
                             <apex:outputText value="Invalid Country Code!" rendered="{!if(!BEGINS(democCode,'+'),true,if(AND(!ISNUMBER(democCode),LEN(democCode)>0 ) ,true,false))}"   styleClass="error-msg-output"  ></apex:outputText>                           
                              <apex:outputText value="Invalid Mobile Number!" rendered="{!if(AND(!ISNUMBER(demoMobile),LEN(demoMobile)>0) ,true,if(AND(LEN(demoMobile)>10,LEN(demoMobile)>0),true,false))}"   styleClass="error-msg-output" style="margin-left:120px;"></apex:outputText>      
                                       </apex:outputPanel>
                                    </div>
                                    <div class=" form-group col-md-4 col-sm-6 col-xs-12">
                                       <label for="Email">Email<span class="req-mark">*</span></label>
                                       <apex:outputPanel id="emailid">
                                          <apex:input type="text" value="{!demoEmail}" html-placeholder="Email"  styleClass="form-control"  >
                                             <apex:actionSupport event="onchange" reRender="emailid" action="{!checkEmail}" />
                                          </apex:input>
                                          <apex:outputText value="{!errormsg1}" rendered="{!AND(demoEmail!='',demoEmail!=null)}" styleClass="error-msg-output"/>
                                       </apex:outputPanel>
                                    </div>
                                 </div>
                                 <div class="form-row ">
                                    <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                       <label for="ShippingStreet">Delivery Street<span class="req-mark">*</span></label>
                                       <apex:input type="text"  value="{!demoStreet}" html-placeholder="Delivery Street" styleClass="form-control" />
                                    </div>
                                
                                 
                                    <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                       <label for="ShippingCity">Delivery City<span class="req-mark">*</span></label>
                                       <apex:input type="text" id="City" value="{!demoCity}" html-placeholder="Delivery City" styleClass="form-control"/>
                                    </div>
                                     <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                       <label for="ShippingState">Delivery County / State<span class="req-mark">*</span></label>
                                       <apex:input type="text" id="ShippingState" value="{!demoState}" html-placeholder="Delivery  County / State" styleClass="form-control">
                                          <apex:actionSupport event="onchange" reRender="stateid"/>
                                       </apex:input>
                                 <!--      <apex:outputPanel id="stateid">
                                          <apex:outputText value="Enter Correct State Name !" rendered="{!if(AND(ISNUMBER(demoState)),true,false)}" styleClass="error-msg-output"></apex:outputText>
                                       </apex:outputPanel>  -->
                                    </div>
                                   
                                   
                                 </div>
                                 <div class="form-row ">
                                  <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                       <label for="ShippingCountry">Delivery Country<span class="req-mark">*</span></label>
                                       <apex:input type="text" id="ShippingCountry" value="{!demoCountry}" html-placeholder="Delivery Country" styleClass="form-control">
                                          <apex:actionSupport event="onchange" reRender="countryid"/>
                                       </apex:input>
                                 <apex:outputPanel id="countryid">
                                          <apex:outputText value="Invalid Country Name!" rendered="{!if(AND(ISNUMBER(demoCountry)),true,false)}" styleClass="error-msg-output"></apex:outputText>
                                       </apex:outputPanel>  
                                    </div>
                                    <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                    <label for="ShippingPostcode">Delivery Postcode / Zipcode<span class="req-mark">*</span></label>
                                       <apex:input type="text"  value="{!demoPostcode}" html-placeholder=" Delivery Postcode / Zipcode" styleClass="form-control"/>
                                       <!--      <apex:actionSupport event="onchange" reRender="zipid"/>
                                          </apex:input>
                                          <apex:outputPanel id="zipid">
                                             <apex:outputText value="Incorrect Zip Value !" rendered="{!if(AND(!ISNUMBER(demoPostcode),LEN(demoPostcode)>0),true,false)}"   styleClass="error-msg-output"></apex:outputText>
                                          </apex:outputPanel>  -->
                                       
                                    </div>
                                    <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                       <label for="DemoStartDateTime">Demo Start Date and Time<span class="req-mark">*</span></label>
                                       <div class="input-group" style="width:100%;">
                                          <!--      <input type ="date"  id="demoStartTime" value="{!demoStartTime}" class="form-control" style="width:70%" />
                                             <input type ="time" class="form-control inputs time"  value="now" style="width:30%" />  -->
                                          <apex:input type="datetime-local" id="DemoStartDateTime" value="{!demoStartTime}" html-placeholder="dd-MM-yyyy : hh:mm:ss" styleClass="form-control" style="border-radius: 3px;" >
                                             <apex:actionSupport event="onchange" reRender="date1id"/>
                                          </apex:input>
                                          <apex:outputPanel id="date1id">
                                             <apex:outputText value="Invalid Date!" rendered="{!IF(AND(NOT(ISBLANK(demoStartTime)),demoStartTime < NOW()-1 ), true, false)}"  style="color:red"></apex:outputText>
                                          </apex:outputPanel>
                                       </div>
                                    </div>
                                   
                                 </div>
                                 <div class="row">                                  
                                    <div class="form-row col-md-12 ">
                                    <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                       <label for="DemoStartDateTime">Demo End Date and Time<span class="req-mark">*</span></label>
                                       <div class="input-group" style="width:100%;">
                                          <!--    <input type ="date"  id="demoEndTime" value="{!demoEndTime}" class="form-control" style="width:70%" />
                                             <input type ="time" class="form-control inputs time"  value="now" style="width:30%" />  -->
                                          <apex:input type="datetime-local" id="DemoEndDateTime" value="{!demoEndTime}"  styleClass="form-control" style="border-radius: 3px;" >
                                             <apex:actionSupport event="onchange" reRender="date2id"/>
                                          </apex:input>
                                          <apex:outputPanel id="date2id">
                                             <apex:outputText value="Invalid Date!" rendered="{!IF(AND(NOT(ISBLANK(demoEndTime)),demoEndTime < NOW()-1), true, false)}"  style="color:red"></apex:outputText>
                                          </apex:outputPanel>
                                       </div></div>
                                       <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                          <label for="ShippingCity">Expected Delivery Date<span class="req-mark">*</span></label>
                                          <apex:input type="date" id="ExpectedDeliveryDate" value="{!demoDeliveryDate}" styleClass="form-control">
                                             <apex:actionSupport event="onchange" reRender="date3id"/>
                                          </apex:input>
                                          <apex:outputPanel id="date3id">
                                             <apex:outputText value="Invalid Date!" rendered="{!IF(AND(NOT(ISBLANK(demoDeliveryDate)),demoDeliveryDate< TODAY()), true, false)}"  style="color:red"></apex:outputText>
                                          </apex:outputPanel>
                                       </div>
                                       <div class="form-group col-md-4 col-sm-6 col-xs-12">
                                          <label for="ShippingPostcode">Expected Return Date<span class="req-mark">*</span></label>
                                          <apex:input type="date" id="ExpectedReturnDate" value="{!demoReturnDate}" html-placeholder="Expected Return Date" styleClass="form-control">
                                             <apex:actionSupport event="onchange" reRender="date4id"/>
                                          </apex:input>
                                          <apex:outputPanel id="date4id">
                                             <apex:outputText value="Invalid Date!" rendered="{!IF(AND(NOT(ISBLANK(demoReturnDate)),demoReturnDate< TODAY()), true, false)}"  style="color:red"></apex:outputText>
                                          </apex:outputPanel>
                                       </div>
                                    </div>
                                 </div>
                                 <div class="form-row ">
                                    <div class="form-group col-md-4 col-sm-4 col-xs-12">
                                       <label for="DoYouWantDelivery">Do You Want Delivery?</label>
                                       <apex:selectList value="{!demoDelivery}" size="1" multiselect="false" styleClass="form-control apex-height" id="DoYouWantDelivery">
                                          <apex:selectOptions value="{!DeliveryList}">
                                          </apex:selectOptions>
                                       </apex:selectList>
                                    </div>
                                    <div class="form-group col-md-4 col-sm-4 col-xs-12">
                                       <label for="Installation Required">Installation Required</label>
                                       <apex:selectList value="{!InstallationRequired}" size="1" multiselect="false" styleClass="form-control apex-height" id="InstallationRequired">                                       
                                          <apex:selectOption itemValue="Yes" itemLabel="Yes"/>
                                           <apex:selectOption itemValue="No" itemLabel="No"/>
                                       </apex:selectList>
                                    </div>
                                 </div>
                                  <div class="form-row ">
                                    <div class="col-md-12">
                                       <h5>Reason for Demo:</h5></div>
                                       <div class="form-row ">
                                    <div class="form-group col-md-6 col-sm-6 col-xs-12">
                                       <label for="DemoReason">Reason for Demo Request<span class="req-mark">*</span></label>
                                      <!-- <apex:input type="text" id="DemoReason" value="{!demoReason}" html-placeholder="Demo Reason"  styleClass="form-control"/>-->
                                       <apex:selectList value="{!demoReason}" size="1" multiselect="false" styleClass="form-control apex-height" >
                                          <apex:selectOptions value="{!DemoReasonList}">
                                          </apex:selectOptions>
                                       </apex:selectList>
                                    </div>
                                    <div class="form-group col-md-6 col-sm-6 col-xs-12">
                                       <label for="Opportunity">Opportunity<span class="req-mark">*</span></label>
                                       <apex:input type="text" id="Motive" value="{!demoMotive}"  html-placeholder="Opportunity" styleClass="form-control" />
                                    </div>
                                    </div>
                                       </div>
                                 <div class="form-row ">
                                    <div class="col-md-12">
                                       <h5>Products needed for Demo:</h5>
                                       <apex:messages style="color:red"/>
                                       <apex:outputPanel id="ProdTabId">
                                          <table class="table table-bordered case-summary-table" id="ProductAddTable" style="margin-bottom:10px;" >
                                             <tbody>
                                                <apex:variable var="count" value="{!0}"   />
                                                <apex:repeat value="{!allProductList}" var="apList" id="TABLIST">
                                                   <tr id="tr1">
                                                      <td class="col-md-1">
                                                         <apex:inputCheckbox id="myCheck"  style="margin: 11px 0px 0px 15px;">
                                                            <apex:actionSupport event="onclick" reRender="none"  action="{!checkFunction}">
                                                               <apex:param name="checkboxcheck" value="{!count}"/>
                                                            </apex:actionSupport>
                                                         </apex:inputCheckbox>
                                                         <!-- <input type="checkbox" id="myCheck" name="chk" style="margin: 11px 0px 0px 15px;"  onclick="myCheckFunction({!count})"/> --->
                                                      </td>
                                                      <td class="col-md-4" id="tdx1">
                                                         <apex:selectList value="{!apList.selectedproductFamily}" size="1" multiselect="false" styleClass="form-control" id="hav7"  >
                                                            <apex:selectOptions value="{!apList.productFamily}"  >
                                                            </apex:selectOptions>
                                                            <apex:actionSupport event="onchange" action="{!WrapProductlist}" reRender="i12">
                                                               <apex:param name="windex" value="{!count}" assignTo="{!wrapIndex}"/>
                                                            </apex:actionSupport>
                                                         </apex:selectList>
                                                      </td>
                                                      <td class="col-md-4 tdxxx" id="td1">
                                                         <apex:outputPanel id="i12">
                                                            <apex:selectList value="{!apList.selectedProd}" size="1" multiselect="false" styleClass="form-control">
                                                               <apex:selectOptions id="oppid" value="{!apList.product}"  />
                                                            </apex:selectList>
                                                         </apex:outputPanel>
                                                      </td>
                                                      <td class="col-md-3" id="qty1">
                                                         <apex:input type="text" styleClass="form-control" value="{!apList.productInfoquantity}" html-placeholder="Qty."/>
                                                      </td>
                                                   </tr>
                                                   <apex:variable value="{!count+1}" var="count"/>
                                                </apex:repeat>
                                             </tbody>
                                          </table>
                                          <div class="form-row form-group" style="float:right;">
                                             <apex:outputPanel >
                                                 <div class="apex-button btn-info"><i class="fa fa fa-plus" aria-hidden="true" style="margin-right:5px;"></i>Add More </div>
                                               <!--<span  class="cursor"><i class="fa fa-plus-circle" style="font-size:25px;color:#0565cc;" title="Add Product"></i> </span>-->
                                                <apex:actionSupport event="onclick" action="{!addproductrow}" reRender="ProdTabId"/>
                                             </apex:outputPanel>
                                             <apex:outputPanel >
                                             <div class="apex-button btn-danger" style="margin-right: 0;"><i class="fa fa-trash" aria-hidden="true" style="margin-right:5px;"></i>Delete</div>
                                              <!--<span  class="cursor"><i class="fa fa-times-circle" style="font-size:25px;color:#d81712;" title="Delete Product"></i></span>-->
                                                <apex:actionSupport event="onclick" action="{!DelProductRow}" reRender="ProdTabId"/>
                                             </apex:outputPanel>
                                          </div>
                                       </apex:outputPanel>
                                    </div>
                                 </div>
                                 <div class="form-row " >
                                    <div class="form-group col-md-12 col-sm-12 col-xs-12">
                                       <label for="Remarks">Remarks (if any)</label>
                                       <apex:input type="text" id="Remarks" value="{!demoRemarks}" html-placeholder="" styleClass="form-control"/>
                                    </div>
                                 </div>
                                 <div class="form-row " >
                                    <div class="form-group col-md-12 col-sm-12 col-xs-12">
                                       <label for="Expected">Expected / Result</label>
                                       <apex:input type="text" id="Expected" value="{!demoExpected}" html-placeholder="" styleClass="form-control"/>
                                    </div>
                                 </div>
                                 
                                 <!--FORM SECTION END HERE-->
                              </div>
                           </div>
                        </div>
                     </div>
                     <!--PANEL FOOTER START HERE-->
                     <div class="panel-footer" style="text-align:right;" >
                        <apex:commandButton value="Clear" action="{!clear}" styleClass="action-button btn-danger btn-width"  style=" margin: 10px 15px 10px 0px;" />
                        <apex:commandButton value="Submit Request" action="{!submitRequest}" styleClass="action-button btn-primary btn-width" style=" margin: 10px 15px 10px 0px;" />
                     </div>
                     <!--PANEL FOOTER END-->
                  </div>
               </div>
            </div>
            <!--#######################SUBMIT conformation Modal MODAL##################################-->
            <!--      <apex:outputPanel styleClass="modal1" layout="block" rendered="{!Submitform==true}" id="panel3">
               <div class="modal-div1">  -->
            <!-- Modal content -->
            <!--      <div class="modal-content1" >
               <div class="modal-header">
                  <div align="right">
                     <button type="button"  onclick="cancelpop()" style=" border-color: black;background: white;">×</button> 
                     <h4 style="text-align:center;">Request Submitted</h4>
                  </div>
                  <apex:actionFunction name="cancelpop"  action="{!CancelPopup}" />
                  <apex:image url="{!URLFOR($Resource.img, 'img/logo.png')}"/>
               </div>
               <div class="modal-body" style="text-align:center;">
                  <apex:image url="{!$Resource.true}" height="40"/>
                  <p style="font-size: 15px; text-align: center; margin-top:10px;">Your Demo Request has been received. Our Team will get back to you.</p>
               </div>
               </div>
               </div>
               </apex:outputPanel>  -->
            <!--#########################################################-->
         </apex:form>
      </div>
      <section>
         <c:portal_footer />
         <a id="back2Top" href="#" title="Go to Top">&#10148;</a>
      </section>
   </body>
</apex:page>
*******************************************apex class ************************************************
/*
        Author: Anita
        Created Date: 1/11/2018
        Created For: This apex class is implemented for Inserting a Demo Request from the portal to the Custom object "Demo Request".
*/


public class DemoRequest_Apex_cntrlr {

    public Id contactId{get;set;}

    /************Mapping values***************/
    public boolean Submitform {
        get;
        set;
    }
    //Inserting fields of Demo Request.
    public string demoContact {
        get;
        set;
    }
    public string demoMobile {
        get;
        set;
    }
    public string demoEmail {
        get;
        set;
    }
    public string demoReason {
        get;
        set;
    }
    public string demoMotive {
        get;
        set;
    }
    public string demoStreet {
        get;
        set;
    }
    public string demoCity {
        get;
        set;
    }
    public string democCode {
        get;
        set;
    }
    public string demoPostcode {
        get;
        set;
    }
    public string demoState {
        get;
        set;
    }
    public string demoCountry {
        get;
        set;
    }
    public date demoDeliveryDate {
        get;
        set;
    }
    public date demoReturnDate {
        get;
        set;
    }

    //creating set for checkbox 
    public Set < Integer > selectcheckbox;

    public datetime demoStartTime {
        get;
        set;
    }
    public datetime demoEndTime {
        get;
        set;
    }

    public string errormsg {
        get;
        set;
    }
    public string errormsg1 {
        get;
        set;
    }
    
    public string errormsgDate {
        get;
        set;
    }    

    public string demoRemarks {
        get;
        set;
    }
    public string demoExpected {
        get;
        set;
    }

    public string InstallationRequired{
        get;
        set;
    }
      public string demoDelivery {
        get;
        set;
    }
    public list < selectOption > DeliveryList {
        get;
        set;
    }
    public list < selectOption > DemoReasonList {
        get;
        set;
    }

    public Demo_Request__c demoReq {
        get;
        set;
    }
    public Demo_Request_product__c demoreqprod {
        get;
        set;
    }

    //variable declaration for Prouct Info
    public list < selectOption > selectProductList {
        get;
        set;
    }
    public string selectProduct {
        get;
        set;
    }
    public list < selectOption > selectProdList {
        get;
        set;
    }
    public string selectedProd {
        get;
        set;
    }
    public list < selectOption > ProductFamilyList {
        get;
        set;
    }
    public string ProductFamily {
        get;
        set;
    }
    public Integer wrapIndex {
        get;
        set;
    }
    public list < allProducts > allProductList {
        get;
        set;
    }
    public Integer wquant2 {
        get;
        set;
    }

    //Defining Constructor  
    public DemoRequest_Apex_cntrlr() {
        selectcheckbox = new Set < Integer > ();
        allProductList = new list < allProducts > ();
        addproductrow();

        //Submitform=false;
        contactId = ApexPages.currentPage().getParameters().get('Id');
        demoStartTime = system.now();
        demoEndTime = system.now();
        demoDeliveryDate = system.today();
        demoReturnDate = system.today();

        DeliveryList = new List < selectOption > ();

        Schema.DescribeFieldResult fieldResult11 = Demo_Request__c.Do_You_Want_delivery__c.getDescribe();
        List < Schema.PicklistEntry > cou21 = fieldResult11.getPicklistValues();
        for (Schema.PicklistEntry f: cou21) {
            DeliveryList.add(new SelectOption(f.getLabel(), f.getValue()));
        }
                     
         DemoReasonList = new List < selectOption > ();

        Schema.DescribeFieldResult fieldResult12 = Demo_Request__c.Reason_for_Demo_request__c.getDescribe();
        DemoReasonList.add(new SelectOption('–None–', '–None–'));
        List < Schema.PicklistEntry > cou22 = fieldResult12.getPicklistValues();
        for (Schema.PicklistEntry f: cou22) {
            DemoReasonList.add(new SelectOption(f.getLabel(), f.getValue()));
        }
        demoReq = New Demo_Request__c();
        //  demoreqprod = new Demo_Request_product__c();                           
    }

    //Submitting data   
    public PageReference submitRequest() {
        if ((errormsg1 ==null || errormsg1 == '' ) && demoContact != '' && demoContact != null && demoMobile != '' && demoMobile != null && demoMobile.isNumeric() && demoMobile.length()<=10 && demoEmail != '' && demoEmail != null && demoReason != '' && demoReason != null && demoMotive != '' && demoMotive != null && demoStreet != '' && demoStreet != null && demoCity != '' && demoCity != null && demoPostcode != '' && demoPostcode != null && democCode !=null && democCode !='' && democCode.startsWith('+') && democCode.substringAfter('+').isNumeric() && demoState != '' && demoState != null && demoCountry != '' && demoCountry != null && !demoCountry.isNumeric() && demoStartTime !=null && demoEndTime !=null && demoDeliveryDate != null && demoReturnDate !=null ) {
          // if( && demoMobile==''& demoMobile==null && demoStartTime ==null && demoEndTime ==null && demoDeliveryDate == null && demoReturnDate ==null ){
            //Inserting data of Demo Request object
            // Demo_Request__c demoReq = New Demo_Request__c(); 
            if((demoStartTime <= demoEndTime  ) && (demoDeliveryDate < demoReturnDate) && (demoStartTime >= demoDeliveryDate && demoEndTime <= demoReturnDate) && ( demoStartTime >= system.now() && demoEndTime >= system.now() &&  demoDeliveryDate >= system.today() && demoReturnDate >= system.today())) {         
            demoReq.Contact__c = demoContact;
            demoReq.Contact_del__c = contactId;
            demoReq.Country_Code__c = democCode;
            demoReq.Phone__c = demoMobile;
            demoReq.Email__c = demoEmail;
            demoReq.Reason_for_Demo_request__c= demoReason;
            demoReq.Motive__c = demoMotive;
            demoReq.Mailing_Street__c = demoStreet;
            demoReq.Mailing_City__c = demoCity;
            demoReq.Postcode_Zipcode__c = demoPostcode;
            demoReq.County_State__c = demoState;
            demoReq.Country__c = demoCountry;
            demoReq.Demo_Start_Date_Time__c = demoStartTime;
            demoReq.Demo_End_Date_Time__c = demoEndTime;
            demoReq.Expected_Delivery_Date__c = demoDeliveryDate;
            demoReq.Expected_Return_Date__c = demoReturnDate;
            demoReq.Remarks__c = demoRemarks;
            demoReq.Expected_Result__c = demoExpected;
            demoReq.Do_You_Want_delivery__c = demoDelivery;
            if(InstallationRequired=='Yes')
              demoReq.Installation_required__c=true;
            else
              demoReq.Installation_required__c=false;
            insert demoReq;
               /* }
               else{ errormsg1 = 'Check Email!';
               return null; }  */
 } else { errormsgDate = 'Demo Start Date & Time should be lesser than Demo End Date & Time and Expected Delivery Date should be lesser than Expected Return Date.';
  return null; }


            List < Demo_Request_product__c > demoreqproduct = new List < Demo_Request_product__c > ();
            system.debug('allProductList===' + allProductList);

            for (allProducts allp: allProductList) {

                system.debug('demoreqproduct ===' + demoreqproduct);
                if (allp.selectedproductFamily != null && allp.selectedproductFamily != '' && allp.productInfoquantity != null && allp.productInfoquantity != '') {

                    for (Product2 p2: [select id, Name, Family, Active__c from Product2 where Name =: allp.selectedProd]) {


                        Demo_Request_product__c demoreqprod = new Demo_Request_product__c();

                        demoreqprod.Product_Family__c = allp.selectedproductFamily;
                        demoreqprod.Product__c = p2.id;
                        demoreqprod.Demo_Request__c = demoReq.id;
                        // demoreqprod.Quantity__c = allp.productInfoquantity;
                        demoreqprod.Quantity__c = Decimal.valueof(allp.productInfoquantity);
                        demoreqproduct.add(demoreqprod);
                        system.debug('demoreqproduct====' + demoreqproduct);
                    }
                } else {
                    // errormsg = 'All Product fields are mandatory.';
                    // return null;
                    ApexPages.addmessage(new ApexPages.message(ApexPages.severity.WARNING, 'Please Fill all Product Details'));
                    return null;
                }
            }

            if (demoreqproduct.size() > 0) {
                insert demoreqproduct;
                system.debug('demoreqproduct====' + demoreqproduct);
            }


            // Submitform=true;


            PageReference page = new PageReference('/apex/DemoRequestList?id=' + contactId);
            page.setRedirect(true);
            return page;
        } else {
            errormsg = 'Please fill required fields.';
            return null;
        }
    }


    public PageReference clear() {
        PageReference page = new PageReference('/apex/DemoRequest_Apex?id=' + contactId);
        page.setRedirect(true);
        return page;
    }


    public list < SelectOption > ProdFamilyList() {
        ProductFamilyList = new List < selectOption > ();
        ProductFamilyList.add(new SelectOption('', 'Please Select'));
        Schema.DescribeFieldResult fieldResult3111 = Demo_Request_product__c.Product_Family__c.getDescribe();
        List < Schema.PicklistEntry > cou3111 = fieldResult3111.getPicklistValues();
        for (Schema.PicklistEntry f: cou3111) {
            ProductFamilyList.add(new SelectOption(f.getLabel(), f.getValue()));
        }
        return ProductFamilyList;
    }

    //Use of Wrapper class
    public class allProducts {
        public list < selectOption > productFamily {
            get;
            set;
        }
        public list < selectOption > product {
            get;
            set;
        }
        public Integer quantity {
            get;
            set;
        }
        public String selectedproductFamily {
            get;
            set;
        }
        public String selectedProd {
            get;
            set;
        }
        public integer WrapperIndex {
            get;
            set;
        }
        public string productInfoquantity {
            get;
            set;
        }
    }

    public void WrapProductlist() {
        string pp = apexpages.currentpage().getparameters().get('windex');
        system.debug('wrapIndex======' + wrapIndex);
        allProductList[wrapIndex].product = getListProduct();
    }

    public void Wrapuantity() {
        system.debug('1==' + allProductList[wrapIndex].quantity);
        allProductList[wrapIndex].quantity = wquant2;
        system.debug('2==' + allProductList[wrapIndex].quantity);
    }

    Public list < SelectOption > getListProduct() {
        selectProductList = new List < selectOption > ();
        if (allProductList[wrapIndex].selectedproductFamily != '') {
            system.debug('productstrin family' + allProductList[wrapIndex].selectedproductFamily);
            for (Product2 p2: [select id, Name, Family, Active__c from Product2 where Family =: allProductList[wrapIndex].selectedproductFamily and Active__c != False]) {
                selectProductList.add(new SelectOption(p2.name, p2.name));
            }
        }
        return selectProductList;
    }

    //Deleting Product row  
    public void DelProductRow() {
        Integer k = allProductList.size();
        for (Integer i = k - 1; i > 0; i--) {
            if (selectcheckbox.contains(i)) {
                allProductList.remove(i);
                selectcheckbox.remove(i);
                system.debug('selectcheckbox---i=' + selectcheckbox);
            }
        }
        system.debug('===allProductList==' + allProductList);
    }

    //Adding Product row
    public void addproductrow() {
        system.debug('hello');
        allProducts ap = new allProducts();
        ap.productFamily = ProdFamilyList();
        allProductList.add(ap);
        system.debug('allProductList=' + allProductList);
    }


    /* public Pagereference CancelPopup(){
       
       Submitform=false;        
         PageReference page =  new PageReference('/apex/DemoRequest_Apex?id='+contactId);
         page.setRedirect(true);
         return page;             
    } */


    public void checkFunction() {
        system.debug('hello');
        string pp = apexpages.currentpage().getparameters().get('checkboxcheck');
        system.debug('pp---=' + pp);
        selectcheckbox.add(Integer.valueof(pp));
        system.debug('selectcheckbox---1=' + selectcheckbox);
    }

  

    public void checkEmail() {
        system.debug('===demoEmail====' + demoEmail);
        if (!Pattern.matches('^[a-zA-Z0-9._|\\\\%#~`=?&/$^*!}{+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}$', demoEmail)) {
            system.debug('===Validatecemailaddress====' + demoEmail);
            //ApexPages.addmessage(new ApexPages.message(ApexPages.severity.INFO, 'Check your email')); 
            errormsg1 = 'Check your email !';

        } else {
            errormsg1 = '';
        }

    }
}
